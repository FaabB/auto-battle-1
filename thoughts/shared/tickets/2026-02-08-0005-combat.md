# Ticket 5: Combat

**Delivers:** Units fight each other, take damage, show health bars, and die

**Depends on:** 4

## What to Implement

| What to implement | How to test |
|-------------------|-------------|
| Attack system (deal damage on attack timer) | Units near each other lose health over time |
| Attack cooldown per unit | Units attack at their attack_speed rate, not every frame |
| Death/despawn system (remove units at 0 HP) | Units disappear when killed |
| Health bars rendered above units | Small red/green bar visible above each unit |
| Health bar updates as damage is taken | Bars shrink as units lose HP |
| Corpse cleanup (despawn dead entities) | No lingering invisible entities after death |

## Context

This is the payoff ticket — units now actually fight. Combined with Ticket 4's movement, you get the full combat loop: spawn → move → engage → fight → die.

**Combat mechanics:**
- Units attack when within `attack_range` of their target
- Damage is applied per attack on a timer (e.g., every 1.0 seconds for attack_speed 1.0)
- When HP reaches 0, the unit is despawned
- Health bars are small rectangles above each unit (green for remaining HP, red for missing HP)

**Performance note:** With potentially many units fighting simultaneously, ensure the attack system doesn't iterate unnecessarily. Units should only attempt to attack their current target, not scan all enemies each frame.

Relevant files:
- `src/components/mod.rs` — Health component (from Ticket 3), attack cooldown timer
- New systems: `unit_attack`, `unit_death`, `health_bar_render`
- `src/screens/in_game.rs` — register combat systems

## Done When

- Spawn player units (from Barracks) and enemy units (debug key from Ticket 4)
- Units walk toward each other and engage
- Health bars appear above units and visibly shrink during combat
- When a unit's HP reaches 0, it disappears
- The winning side's surviving units resume moving toward the opposing fortress
- No ghost entities or orphaned health bars remain after combat

## References

- Source: `thoughts/shared/research/2026-02-04-tano-style-game-research.md` (Section 2.3 Unit System, Section 3.2 ECS Components — Health, Combat)
